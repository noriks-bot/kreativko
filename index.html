<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kreativko | NORIKS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f1117;
            --bg-card: #181b23;
            --bg-hover: #1f232d;
            --border: #2a2f3a;
            --text: #f4f4f5;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --green: #22c55e;
            --green-bg: rgba(34, 197, 94, 0.12);
            --red: #ef4444;
            --red-bg: rgba(239, 68, 68, 0.12);
            --blue: #3b82f6;
            --blue-bg: rgba(59, 130, 246, 0.12);
            --orange: #f97316;
            --orange-bg: rgba(249, 115, 22, 0.12);
            --purple: #a855f7;
            --purple-bg: rgba(168, 85, 247, 0.12);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 32px;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        
        .logo-icon {
            width: 42px;
            height: 42px;
            background: var(--purple);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .logo h1 {
            font-size: 20px;
            font-weight: 700;
        }
        
        .logo p {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--green-bg);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: var(--green);
        }
        
        .status-dot {
            width: 7px;
            height: 7px;
            background: var(--green);
            border-radius: 50%;
        }
        
        .btn {
            padding: 9px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn:hover {
            background: var(--bg-hover);
            border-color: #3f4555;
        }
        
        .btn-logout {
            background: var(--red-bg);
            border-color: rgba(239, 68, 68, 0.2);
            color: var(--red);
        }
        
        /* Month Filter */
        .month-filter {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }
        
        .month-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .month-btn:hover {
            background: var(--bg-hover);
            color: var(--text);
        }
        
        .month-btn.active {
            background: var(--purple);
            border-color: var(--purple);
            color: white;
        }
        
        .month-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
        }
        
        .stat-card.green { border-left: 3px solid var(--green); }
        .stat-card.orange { border-left: 3px solid var(--orange); }
        .stat-card.purple { border-left: 3px solid var(--purple); }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
        }
        
        .stat-card.green .stat-value { color: var(--green); }
        .stat-card.orange .stat-value { color: var(--orange); }
        .stat-card.purple .stat-value { color: var(--purple); }
        
        .stat-sub {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        /* Creator Cards */
        .creators-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .creator-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            border-top: 3px solid var(--purple);
        }
        
        .creator-card.green { border-top-color: var(--green); }
        .creator-card.orange { border-top-color: var(--orange); }
        
        .creator-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 20px;
        }
        
        .creator-avatar {
            width: 48px;
            height: 48px;
            background: var(--purple);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            color: white;
        }
        
        .creator-card.green .creator-avatar { background: var(--green); }
        .creator-card.orange .creator-avatar { background: var(--orange); }
        
        .creator-name { font-size: 16px; font-weight: 600; }
        .creator-initials { font-size: 12px; color: var(--text-muted); }
        
        .creator-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .creator-stat {
            background: var(--bg);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        
        .creator-stat-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .creator-stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .creator-bonus {
            background: var(--green-bg);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 8px;
            padding: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .bonus-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--green);
        }
        
        .bonus-value {
            font-size: 22px;
            font-weight: 700;
            color: var(--green);
        }
        
        /* Table Card */
        .table-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 24px;
        }
        
        .table-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-header h2 {
            font-size: 15px;
            font-weight: 600;
        }
        
        .table-badges {
            display: flex;
            gap: 8px;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge.default {
            background: rgba(255,255,255,0.05);
            color: var(--text-secondary);
        }
        
        .badge.green {
            background: var(--green-bg);
            color: var(--green);
        }
        
        .table-scroll {
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th {
            background: #14171f;
            padding: 12px 16px;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border);
        }
        
        td {
            padding: 14px 16px;
            font-size: 13px;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }
        
        tr:hover td {
            background: rgba(255,255,255,0.02);
        }
        
        td.success { color: var(--green); font-weight: 600; }
        td.fail { color: var(--text-muted); }
        
        .creative-name {
            font-weight: 500;
            color: var(--text);
            max-width: 350px;
            word-break: break-all;
        }
        
        /* Tier Table */
        .tier-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 24px;
        }
        
        .tier-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .tier-header h2 {
            font-size: 15px;
            font-weight: 600;
        }
        
        .tier-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .tier-table th, .tier-table td {
            padding: 12px 16px;
            text-align: center;
            font-size: 13px;
        }
        
        .tier-table th {
            background: #14171f;
            color: var(--text-muted);
            font-size: 11px;
            text-transform: uppercase;
        }
        
        .tier-table td {
            border-bottom: 1px solid var(--border);
        }
        
        .tier-table td.active {
            background: var(--green-bg);
            color: var(--green);
            font-weight: 600;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 60px;
        }
        
        .spinner {
            width: 36px;
            height: 36px;
            border: 3px solid var(--border);
            border-top-color: var(--purple);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        @media (max-width: 1000px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .creators-grid { grid-template-columns: 1fr; }
            .container { padding: 16px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon">üí∞</div>
                <div>
                    <h1>Kreativko</h1>
                    <p>Creator Reward System</p>
                </div>
            </div>
            <div class="header-right">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    Povezano
                </div>
                <span id="userInfo" style="font-size:12px;color:var(--text-muted);">üë§ Loading...</span>
                <button class="btn" onclick="loadData(currentMonth)">‚Üª Osve≈æi</button>
                <button class="btn btn-logout" onclick="logout()">üö™</button>
            </div>
        </header>
        
        <div class="month-filter" id="monthFilter"></div>
        
        <main id="content">
            <div class="loading">
                <div class="spinner"></div>
                <p>Nalagam...</p>
            </div>
        </main>
        
        <footer class="footer">
            Built by üíª Roki ¬∑ NORIKS ¬© 2026
        </footer>
    </div>
    
    <script>
function logout() {
    fetch('api/logout').then(() => window.location.href = 'login');
}

let currentMonth = new Date().getMonth() + 1;
let currentYear = new Date().getFullYear();
let userRole = 'admin';
let userInitials = null;

function renderMonthFilter() {
    const container = document.getElementById('monthFilter');
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const now = new Date();
    container.innerHTML = months.map((m, i) => {
        const month = i + 1;
        const isActive = month === currentMonth;
        const isFuture = month > now.getMonth() + 1;
        return `<button class="month-btn ${isActive ? 'active' : ''}" ${isFuture ? 'disabled' : ''} onclick="selectMonth(${month})">${m}</button>`;
    }).join('');
}

function selectMonth(month) {
    currentMonth = month;
    renderMonthFilter();
    loadData(month);
}

async function loadData(month) {
    const content = document.getElementById('content');
    content.innerHTML = '<div class="loading"><div class="spinner"></div><p>Nalagam...</p></div>';
    
    try {
        const res = await fetch(`api/creatives?year=${currentYear}&month=${month}`);
        if (!res.ok) {
            if (res.status === 401) { window.location.href = 'login'; return; }
            throw new Error('API Error');
        }
        const data = await res.json();
        userRole = data.userRole || 'admin';
        userInitials = data.userInitials;
        document.getElementById('userInfo').textContent = 'üë§ Admin';
        renderData(data);
    } catch (e) {
        console.error(e);
        content.innerHTML = '<div class="loading"><p style="color:var(--red);">Napaka pri nalaganju</p></div>';
    }
}

function renderData(data) {
    const content = document.getElementById('content');
    const stats = data.creatorStats;
    const creatives = data.creatives;
    const top = data.topCreatives;
    
    let filteredStats = stats;
    let filteredCreatives = creatives;
    if (userRole === 'creator' && userInitials) {
        filteredStats = { [userInitials]: stats[userInitials] };
        filteredCreatives = creatives.filter(c => c.creator === userInitials);
    }
    
    const totalCreatives = Object.values(filteredStats).reduce((a, c) => a + c.total, 0);
    const totalSuccessful = Object.values(filteredStats).reduce((a, c) => a + c.successful, 0);
    const totalBonus = Object.values(filteredStats).reduce((a, c) => a + c.totalBonus, 0);
    const avgSuccess = totalCreatives > 0 ? Math.round((totalSuccessful / totalCreatives) * 100) : 0;
    
    const colors = ['purple', 'green', 'orange'];
    
    content.innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Kreativ</div>
                <div class="stat-value">${totalCreatives}</div>
                <div class="stat-sub">Ta mesec</div>
            </div>
            <div class="stat-card green">
                <div class="stat-label">Uspe≈°nih (2+ nakupov)</div>
                <div class="stat-value">${totalSuccessful}</div>
                <div class="stat-sub">${avgSuccess}% success rate</div>
            </div>
            <div class="stat-card orange">
                <div class="stat-label">Top Kreativ (500+)</div>
                <div class="stat-value">${top.count}</div>
                <div class="stat-sub">‚Ç¨${top.bonusPerCreative}/vsaka</div>
            </div>
            <div class="stat-card purple">
                <div class="stat-label">Skupni Bonus</div>
                <div class="stat-value">‚Ç¨${totalBonus.toFixed(0)}</div>
                <div class="stat-sub">Vsi kreatorji</div>
            </div>
        </div>
        
        <div class="creators-grid">
            ${Object.values(filteredStats).map((c, i) => `
                <div class="creator-card ${colors[i % 3]}">
                    <div class="creator-header">
                        <div class="creator-avatar">${c.initials}</div>
                        <div>
                            <div class="creator-name">${c.name}</div>
                            <div class="creator-initials">${c.initials}</div>
                        </div>
                    </div>
                    <div class="creator-stats">
                        <div class="creator-stat">
                            <div class="creator-stat-value">${c.total}</div>
                            <div class="creator-stat-label">Total</div>
                        </div>
                        <div class="creator-stat">
                            <div class="creator-stat-value" style="color:var(--green)">${c.successful}</div>
                            <div class="creator-stat-label">Uspe≈°nih</div>
                        </div>
                        <div class="creator-stat">
                            <div class="creator-stat-value">${c.successRate}%</div>
                            <div class="creator-stat-label">Success</div>
                        </div>
                        <div class="creator-stat">
                            <div class="creator-stat-value" style="color:var(--orange)">‚Ç¨${c.bonusPerPiece}</div>
                            <div class="creator-stat-label">Per Piece</div>
                        </div>
                    </div>
                    <div class="creator-bonus">
                        <span class="bonus-label">üí∞ Skupni Bonus</span>
                        <span class="bonus-value">‚Ç¨${c.totalBonus.toFixed(0)}</span>
                    </div>
                </div>
            `).join('')}
        </div>
        
        <div class="tier-card">
            <div class="tier-header"><h2>üìä Success Rate Bonus Tiers</h2></div>
            <table class="tier-table">
                <thead>
                    <tr>
                        <th>Success Rate</th>
                        <th>&lt;15%</th>
                        <th>15-19%</th>
                        <th>20-29%</th>
                        <th>30-39%</th>
                        <th>40-69%</th>
                        <th>70%+</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Bonus/Piece</strong></td>
                        <td class="${avgSuccess < 15 ? 'active' : ''}">‚Ç¨0</td>
                        <td class="${avgSuccess >= 15 && avgSuccess < 20 ? 'active' : ''}">‚Ç¨2</td>
                        <td class="${avgSuccess >= 20 && avgSuccess < 30 ? 'active' : ''}">‚Ç¨3</td>
                        <td class="${avgSuccess >= 30 && avgSuccess < 40 ? 'active' : ''}">‚Ç¨3.50</td>
                        <td class="${avgSuccess >= 40 && avgSuccess < 70 ? 'active' : ''}">‚Ç¨5</td>
                        <td class="${avgSuccess >= 70 ? 'active' : ''}">‚Ç¨10</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="tier-card">
            <div class="tier-header">
                <h2>üèÜ Top Creatives Bonus (500+ Sales)</h2>
            </div>
            <table class="tier-table">
                <thead>
                    <tr>
                        <th>≈†tevilo</th>
                        <th>1-5</th>
                        <th>6-10</th>
                        <th>11-15</th>
                        <th>16-20</th>
                        <th>21-30</th>
                        <th>31-40</th>
                        <th>41-50</th>
                        <th>51+</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Bonus/Creative</strong></td>
                        <td class="${top.count >= 1 && top.count <= 5 ? 'active' : ''}">‚Ç¨40</td>
                        <td class="${top.count >= 6 && top.count <= 10 ? 'active' : ''}">‚Ç¨50</td>
                        <td class="${top.count >= 11 && top.count <= 15 ? 'active' : ''}">‚Ç¨60</td>
                        <td class="${top.count >= 16 && top.count <= 20 ? 'active' : ''}">‚Ç¨70</td>
                        <td class="${top.count >= 21 && top.count <= 30 ? 'active' : ''}">‚Ç¨80</td>
                        <td class="${top.count >= 31 && top.count <= 40 ? 'active' : ''}">‚Ç¨90</td>
                        <td class="${top.count >= 41 && top.count <= 50 ? 'active' : ''}">‚Ç¨100</td>
                        <td class="${top.count >= 51 ? 'active' : ''}">Special</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="table-card">
            <div class="table-header">
                <h2>üìã Vse Kreative</h2>
                <div class="table-badges">
                    <span class="badge default">${filteredCreatives.length} Total</span>
                    <span class="badge green">${filteredCreatives.filter(c => c.successful).length} Uspe≈°nih</span>
                </div>
            </div>
            <div class="table-scroll">
                <table>
                    <thead>
                        <tr>
                            <th>Kreativa</th>
                            <th>Kreator</th>
                            <th>Spend</th>
                            <th>Nakupi</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredCreatives.map(c => `
                            <tr>
                                <td class="creative-name">${c.name}</td>
                                <td>${c.creatorName} (${c.creator})</td>
                                <td>‚Ç¨${c.spend.toFixed(2)}</td>
                                <td>${c.purchases}</td>
                                <td class="${c.successful ? 'success' : 'fail'}">${c.successful ? '‚úÖ Uspe≈°na' : '‚ùå Neuspe≈°na'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
        
        <p style="text-align:center;color:var(--text-muted);font-size:11px;">
            Zadnja posodobitev: ${new Date(data.lastUpdated).toLocaleString('sl-SI')}
        </p>
    `;
}

renderMonthFilter();
loadData(currentMonth);
    </script>
</body>
</html>
