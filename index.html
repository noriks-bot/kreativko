<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kreativko | Noriks</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
:root {
    --bg-base: #050507;
    --bg-raised: #0c0c0f;
    --bg-overlay: #16161a;
    --bg-subtle: #111114;
    --bg-hover: #1c1c21;
    --border-subtle: rgba(255,255,255,0.04);
    --border-default: rgba(255,255,255,0.08);
    --border-strong: rgba(255,255,255,0.12);
    --text-primary: #fafafa;
    --text-secondary: #a1a1aa;
    --text-muted: #71717a;
    --text-dim: #52525b;
    --accent-primary: #a855f7;
    --accent-primary-soft: rgba(168, 85, 247, 0.12);
    --accent-green: #10b981;
    --accent-green-soft: rgba(16, 185, 129, 0.12);
    --accent-amber: #f59e0b;
    --accent-amber-soft: rgba(245, 158, 11, 0.12);
    --accent-red: #ef4444;
    --accent-red-soft: rgba(239, 68, 68, 0.12);
    --accent-cyan: #06b6d4;
    --accent-cyan-soft: rgba(6, 182, 212, 0.12);
    --accent-blue: #6366f1;
    --accent-blue-soft: rgba(99, 102, 241, 0.12);
    --gradient-1: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
    --gradient-2: linear-gradient(135deg, #10b981 0%, #059669 100%);
    --gradient-3: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    --shadow-sm: 0 2px 4px rgba(0,0,0,0.5);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.5);
    --shadow-glow: 0 0 40px rgba(168, 85, 247, 0.15);
    --radius: 10px;
    --radius-lg: 14px;
}

[data-theme="light"] {
    --bg-base: #f8fafc;
    --bg-raised: #ffffff;
    --bg-overlay: #f1f5f9;
    --bg-subtle: #f8fafc;
    --bg-hover: #e2e8f0;
    --border-subtle: rgba(0,0,0,0.04);
    --border-default: rgba(0,0,0,0.08);
    --border-strong: rgba(0,0,0,0.12);
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --text-muted: #64748b;
    --text-dim: #94a3b8;
    --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
    --shadow-glow: 0 0 40px rgba(168, 85, 247, 0.08);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
    font-family: 'Inter', system-ui, sans-serif; 
    background: var(--bg-base); 
    color: var(--text-primary);
    min-height: 100vh;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
}

.dashboard { width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 24px 48px; }

/* Header */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 0;
    border-bottom: 1px solid var(--border-subtle);
    margin-bottom: 32px;
}
.header-left { display: flex; align-items: center; gap: 16px; }
.logo { display: flex; align-items: center; gap: 12px; }
.logo-icon {
    width: 40px; height: 40px;
    background: var(--gradient-1);
    border-radius: var(--radius);
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; font-weight: 800; color: white;
    box-shadow: var(--shadow-md), var(--shadow-glow);
}
.logo-text { font-size: 16px; font-weight: 700; letter-spacing: -0.3px; }
.header-divider { color: var(--text-dim); }
.header-title { font-size: 14px; color: var(--text-muted); font-weight: 500; }
.header-right { display: flex; align-items: center; gap: 12px; }
.theme-toggle {
    width: 36px; height: 36px;
    border-radius: var(--radius);
    border: 1px solid var(--border-default);
    background: var(--bg-raised);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
}
.theme-toggle:hover { background: var(--bg-hover); border-color: var(--border-strong); }
.header-time, .header-badge {
    font-size: 12px; color: var(--text-muted);
    padding: 8px 14px;
    background: var(--bg-raised);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius);
}
.btn-logout {
    padding: 8px 14px;
    background: var(--accent-red-soft);
    border: none;
    border-radius: var(--radius);
    color: var(--accent-red);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
}
.btn-logout:hover { background: rgba(239, 68, 68, 0.2); }

/* Month Filter */
.month-filter {
    display: flex; gap: 4px; flex-wrap: wrap;
    background: var(--bg-subtle);
    padding: 4px;
    border-radius: var(--radius);
    margin-bottom: 24px;
}
.month-btn {
    padding: 8px 16px;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: var(--text-muted);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s;
}
.month-btn:hover { color: var(--text-primary); background: var(--bg-hover); }
.month-btn.active {
    background: var(--accent-primary);
    color: white;
    box-shadow: var(--shadow-sm);
}

/* Cards */
.card {
    background: var(--bg-raised);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    margin-bottom: 24px;
    box-shadow: var(--shadow-sm);
}
.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-subtle);
}
.card-header h2 { font-size: 15px; font-weight: 600; }
.card-badges { display: flex; gap: 8px; }
.badge {
    font-size: 11px; font-weight: 500;
    padding: 6px 12px;
    border-radius: 100px;
    background: var(--bg-overlay);
    color: var(--text-secondary);
}
.badge.green { background: var(--accent-green-soft); color: var(--accent-green); }
.badge.amber { background: var(--accent-amber-soft); color: var(--accent-amber); }
.badge.purple { background: var(--accent-primary-soft); color: var(--accent-primary); }
.card-body { padding: 24px; }
.card-body.no-padding { padding: 0; }

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}
.stat-card {
    background: var(--bg-subtle);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius);
    padding: 20px;
}
.stat-label { font-size: 12px; color: var(--text-muted); margin-bottom: 8px; }
.stat-value { font-size: 28px; font-weight: 700; letter-spacing: -1px; }
.stat-value.green { color: var(--accent-green); }
.stat-value.amber { color: var(--accent-amber); }
.stat-value.purple { color: var(--accent-primary); }
.stat-sub { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

/* Creator Cards */
.creators-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 20px;
}
.creator-card {
    background: var(--bg-subtle);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    padding: 24px;
    position: relative;
    overflow: hidden;
}
.creator-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: var(--gradient-1);
}
.creator-card.green::before { background: var(--gradient-2); }
.creator-card.amber::before { background: var(--gradient-3); }
.creator-header { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
.creator-avatar {
    width: 56px; height: 56px;
    border-radius: var(--radius);
    display: flex; align-items: center; justify-content: center;
    font-size: 20px; font-weight: 700; color: white;
    background: var(--gradient-1);
}
.creator-card.green .creator-avatar { background: var(--gradient-2); }
.creator-card.amber .creator-avatar { background: var(--gradient-3); }
.creator-name { font-size: 16px; font-weight: 600; }
.creator-initials { font-size: 12px; color: var(--text-muted); }
.creator-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
.creator-stat { text-align: center; padding: 12px; background: var(--bg-base); border-radius: 8px; }
.creator-stat-value { font-size: 20px; font-weight: 700; }
.creator-stat-label { font-size: 11px; color: var(--text-muted); }
.creator-bonus {
    display: flex; justify-content: space-between; align-items: center;
    padding: 16px;
    background: var(--accent-green-soft);
    border-radius: 8px;
}
.bonus-label { font-size: 13px; font-weight: 500; color: var(--accent-green); }
.bonus-value { font-size: 24px; font-weight: 700; color: var(--accent-green); }

/* Table */
.data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.data-table th {
    text-align: left;
    padding: 14px 20px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    background: var(--bg-subtle);
    border-bottom: 1px solid var(--border-subtle);
}
.data-table td {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border-subtle);
    color: var(--text-secondary);
}
.data-table tr:hover td { background: var(--bg-hover); }
.data-table .success { color: var(--accent-green); }
.data-table .fail { color: var(--text-dim); }
.creative-name { font-weight: 500; color: var(--text-primary); max-width: 400px; word-break: break-all; }

/* Tier Table */
.tier-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.tier-table th, .tier-table td { padding: 12px 16px; text-align: center; }
.tier-table th { background: var(--bg-subtle); color: var(--text-muted); font-size: 11px; text-transform: uppercase; }
.tier-table td { border-bottom: 1px solid var(--border-subtle); }
.tier-table .active { background: var(--accent-green-soft); color: var(--accent-green); font-weight: 600; }

/* Footer */
.footer {
    text-align: center;
    padding: 24px;
    color: var(--text-dim);
    font-size: 12px;
    border-top: 1px solid var(--border-subtle);
    margin-top: 48px;
}

/* Loading */
.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 60px;
    color: var(--text-muted);
}
.spinner {
    width: 24px; height: 24px;
    border: 2px solid var(--border-default);
    border-top-color: var(--accent-primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-right: 12px;
}
@keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="dashboard">
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <span class="logo-icon">K</span>
                    <span class="logo-text">NORIKS</span>
                </div>
                <span class="header-divider">|</span>
                <span class="header-title">Kreativko <span style="color:var(--accent-green);font-size:10px;">‚óè LIVE</span></span>
            </div>
            <div class="header-right">
                <button class="theme-toggle" id="themeToggle"><span class="theme-icon">üåô</span></button>
                <span class="header-time" id="currentTime"></span>
                <span class="header-badge" id="refreshIndicator">‚Üª 60s</span>
                <span class="header-badge" id="userInfo">üë§ Loading...</span>
                <button class="btn-logout" onclick="logout()">üö™ Logout</button>
            </div>
        </header>

        <div class="month-filter" id="monthFilter"></div>

        <div id="content">
            <div class="loading"><div class="spinner"></div>Loading data...</div>
        </div>

        <footer class="footer">
            <p>Built by üíª Roki | NORIKS ¬© 2026</p>
        </footer>
    </div>

    <script>
// Theme
const themeToggle = document.getElementById('themeToggle');
const themeIcon = themeToggle?.querySelector('.theme-icon');
const html = document.documentElement;
const savedTheme = localStorage.getItem('kreativko-theme') || 'dark';
html.setAttribute('data-theme', savedTheme);
if (themeIcon) themeIcon.textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
themeToggle?.addEventListener('click', () => {
    const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', next);
    localStorage.setItem('kreativko-theme', next);
    if (themeIcon) themeIcon.textContent = next === 'dark' ? 'üåô' : '‚òÄÔ∏è';
});

// Time
function updateTime() {
    const el = document.getElementById('currentTime');
    if (el) el.textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) + ' UTC';
}
updateTime();
setInterval(updateTime, 1000);

// Countdown
let countdown = 60;
setInterval(() => {
    const el = document.getElementById('refreshIndicator');
    if (el) el.textContent = '‚Üª ' + countdown + 's';
    if (--countdown < 0) { countdown = 60; loadData(currentMonth); }
}, 1000);

// Logout
function logout() {
    fetch('/logout', { method: 'POST' }).then(() => window.location.href = '/login');
}

// State
let currentMonth = new Date().getMonth() + 1;
let currentYear = new Date().getFullYear();
let userRole = 'admin';
let userInitials = null;

// Month filter
function renderMonthFilter() {
    const container = document.getElementById('monthFilter');
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const now = new Date();
    container.innerHTML = months.map((m, i) => {
        const month = i + 1;
        const isActive = month === currentMonth;
        const isFuture = month > now.getMonth() + 1;
        return `<button class="month-btn ${isActive ? 'active' : ''}" ${isFuture ? 'disabled style="opacity:0.3"' : ''} onclick="selectMonth(${month})">${m}</button>`;
    }).join('');
}

function selectMonth(month) {
    currentMonth = month;
    renderMonthFilter();
    loadData(month);
}

// Load data
async function loadData(month) {
    const content = document.getElementById('content');
    content.innerHTML = '<div class="loading"><div class="spinner"></div>Loading data...</div>';
    
    try {
        const res = await fetch(`/api/data?year=${currentYear}&month=${month}`);
        if (!res.ok) {
            if (res.status === 401) { window.location.href = '/login'; return; }
            throw new Error('API Error');
        }
        const json = await res.json();
        userRole = json.userRole || 'admin';
        userInitials = json.userInitials;
        document.getElementById('userInfo').textContent = 'üë§ ' + (json.userName || 'Admin');
        renderData(json.data);
    } catch (e) {
        content.innerHTML = '<div class="loading">Error loading data</div>';
    }
}

// Render
function renderData(data) {
    const content = document.getElementById('content');
    const stats = data.creatorStats;
    const creatives = data.creatives;
    const top = data.topCreatives;
    
    // Filter for creator role
    let filteredStats = stats;
    let filteredCreatives = creatives;
    if (userRole === 'creator' && userInitials) {
        filteredStats = { [userInitials]: stats[userInitials] };
        filteredCreatives = creatives.filter(c => c.creator === userInitials);
    }
    
    // Calculate totals
    const totalCreatives = Object.values(filteredStats).reduce((a, c) => a + c.total, 0);
    const totalSuccessful = Object.values(filteredStats).reduce((a, c) => a + c.successful, 0);
    const totalBonus = Object.values(filteredStats).reduce((a, c) => a + c.totalBonus, 0);
    const avgSuccess = totalCreatives > 0 ? Math.round((totalSuccessful / totalCreatives) * 100) : 0;
    
    content.innerHTML = `
        <!-- Summary Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Creatives</div>
                <div class="stat-value">${totalCreatives}</div>
                <div class="stat-sub">This month</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Successful (2+ purchases)</div>
                <div class="stat-value green">${totalSuccessful}</div>
                <div class="stat-sub">${avgSuccess}% success rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Top Creatives (500+)</div>
                <div class="stat-value amber">${top.count}</div>
                <div class="stat-sub">‚Ç¨${top.bonusPerCreative}/each</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Bonus</div>
                <div class="stat-value purple">‚Ç¨${totalBonus.toFixed(2)}</div>
                <div class="stat-sub">All creators</div>
            </div>
        </div>
        
        <!-- Creator Cards -->
        <section class="card">
            <div class="card-header">
                <h2>üë• Creator Performance</h2>
                <div class="card-badges">
                    <span class="badge">${Object.keys(filteredStats).length} Creators</span>
                </div>
            </div>
            <div class="card-body">
                <div class="creators-grid">
                    ${Object.values(filteredStats).map((c, i) => `
                        <div class="creator-card ${i === 0 ? 'purple' : i === 1 ? 'green' : 'amber'}">
                            <div class="creator-header">
                                <div class="creator-avatar">${c.initials}</div>
                                <div>
                                    <div class="creator-name">${c.name}</div>
                                    <div class="creator-initials">${c.initials}</div>
                                </div>
                            </div>
                            <div class="creator-stats">
                                <div class="creator-stat">
                                    <div class="creator-stat-value">${c.total}</div>
                                    <div class="creator-stat-label">Total</div>
                                </div>
                                <div class="creator-stat">
                                    <div class="creator-stat-value" style="color:var(--accent-green)">${c.successful}</div>
                                    <div class="creator-stat-label">Successful</div>
                                </div>
                                <div class="creator-stat">
                                    <div class="creator-stat-value">${c.successRate}%</div>
                                    <div class="creator-stat-label">Success Rate</div>
                                </div>
                                <div class="creator-stat">
                                    <div class="creator-stat-value" style="color:var(--accent-amber)">‚Ç¨${c.bonusPerPiece}</div>
                                    <div class="creator-stat-label">Per Piece</div>
                                </div>
                            </div>
                            <div class="creator-bonus">
                                <span class="bonus-label">üí∞ Total Bonus</span>
                                <span class="bonus-value">‚Ç¨${c.totalBonus.toFixed(2)}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </section>
        
        <!-- Bonus Tiers -->
        <section class="card">
            <div class="card-header">
                <h2>üìä Success Rate Bonus Tiers</h2>
            </div>
            <div class="card-body no-padding">
                <table class="tier-table">
                    <thead>
                        <tr>
                            <th>Success Rate</th>
                            <th>&lt;15%</th>
                            <th>15-19%</th>
                            <th>20-29%</th>
                            <th>30-39%</th>
                            <th>40-69%</th>
                            <th>70%+</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Bonus/Piece</strong></td>
                            <td class="${avgSuccess < 15 ? 'active' : ''}">‚Ç¨0</td>
                            <td class="${avgSuccess >= 15 && avgSuccess < 20 ? 'active' : ''}">‚Ç¨2</td>
                            <td class="${avgSuccess >= 20 && avgSuccess < 30 ? 'active' : ''}">‚Ç¨3</td>
                            <td class="${avgSuccess >= 30 && avgSuccess < 40 ? 'active' : ''}">‚Ç¨3.50</td>
                            <td class="${avgSuccess >= 40 && avgSuccess < 70 ? 'active' : ''}">‚Ç¨5</td>
                            <td class="${avgSuccess >= 70 ? 'active' : ''}">‚Ç¨10</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Top Creatives Tiers -->
        <section class="card">
            <div class="card-header">
                <h2>üèÜ Top Creatives Bonus (500+ Sales)</h2>
                <div class="card-badges">
                    <span class="badge amber">${top.count} Top Creatives</span>
                </div>
            </div>
            <div class="card-body no-padding">
                <table class="tier-table">
                    <thead>
                        <tr>
                            <th>Count</th>
                            <th>1-5</th>
                            <th>6-10</th>
                            <th>11-15</th>
                            <th>16-20</th>
                            <th>21-30</th>
                            <th>31-40</th>
                            <th>41-50</th>
                            <th>51+</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Bonus/Creative</strong></td>
                            <td class="${top.count >= 1 && top.count <= 5 ? 'active' : ''}">‚Ç¨40</td>
                            <td class="${top.count >= 6 && top.count <= 10 ? 'active' : ''}">‚Ç¨50</td>
                            <td class="${top.count >= 11 && top.count <= 15 ? 'active' : ''}">‚Ç¨60</td>
                            <td class="${top.count >= 16 && top.count <= 20 ? 'active' : ''}">‚Ç¨70</td>
                            <td class="${top.count >= 21 && top.count <= 30 ? 'active' : ''}">‚Ç¨80</td>
                            <td class="${top.count >= 31 && top.count <= 40 ? 'active' : ''}">‚Ç¨90</td>
                            <td class="${top.count >= 41 && top.count <= 50 ? 'active' : ''}">‚Ç¨100</td>
                            <td class="${top.count >= 51 ? 'active' : ''}">Special</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Creatives Table -->
        <section class="card">
            <div class="card-header">
                <h2>üìã All Creatives</h2>
                <div class="card-badges">
                    <span class="badge">${filteredCreatives.length} Total</span>
                    <span class="badge green">${filteredCreatives.filter(c => c.successful).length} Successful</span>
                </div>
            </div>
            <div class="card-body no-padding">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Creative</th>
                            <th>Creator</th>
                            <th>Spend</th>
                            <th>Purchases</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredCreatives.map(c => `
                            <tr>
                                <td class="creative-name">${c.name}</td>
                                <td>${c.creatorName} (${c.creator})</td>
                                <td>‚Ç¨${c.spend.toFixed(2)}</td>
                                <td>${c.purchases}</td>
                                <td class="${c.successful ? 'success' : 'fail'}">${c.successful ? '‚úÖ Success' : '‚ùå Failed'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </section>
        
        <p style="text-align:center;color:var(--text-dim);font-size:11px;margin-top:16px;">
            Last updated: ${new Date(data.lastUpdated).toLocaleString()}
        </p>
    `;
}

// Init
renderMonthFilter();
loadData(currentMonth);
    </script>
</body>
</html>
